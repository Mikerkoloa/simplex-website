<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimPlex探測器二進制自動計算</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .input-section {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .input-section label {
            font-size: 16px;
            font-weight: bold;
            color: #555;
            display: block;
            margin-bottom: 10px;
        }
        
        .input-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .input-section input {
            font-size: 20px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            width: 150px;
            text-align: center;
            min-width: 120px;
        }
        
        .input-section button {
            font-size: 16px;
            padding: 12px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .input-section button:hover {
            background-color: #0056b3;
        }
        
        .clear-history {
            background-color: #dc3545;
            font-size: 14px;
            padding: 8px 16px;
        }
        
        .clear-history:hover {
            background-color: #c82333;
        }
        
        .result-section {
            display: none;
            margin-top: 20px;
        }
        
        .dip-switches {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }
        
        .switch-group {
            text-align: center;
            padding: 15px;
            border: 2px solid #333;
            border-radius: 10px;
            background-color: #f8f9fa;
        }
        
        .switch-group h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #333;
            font-size: 1.2rem;
        }
        
        .switches {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .switch {
            width: 50px;
            height: 70px;
            border: 2px solid #333;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 5px;
            background-color: white;
            min-width: 45px;
        }
        
        .switch-number {
            font-size: 12px;
            font-weight: bold;
        }
        
        .switch-position {
            width: 35px;
            height: 25px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
        }
        
        .switch-on {
            background-color: #28a745;
        }
        
        .switch-off {
            background-color: #dc3545;
        }
        
        .binary-display {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }
        
        .info {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .error {
            background-color: #ffe7e7;
            color: #d63384;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            display: none;
        }
        
        .history-section {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .history-section h3 {
            margin-top: 0;
            color: #333;
            font-size: 1.1rem;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px;
        }
        
        .history-item:hover {
            background-color: #e9ecef;
        }
        
        .history-item-header {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        
        .history-item-details {
            color: #666;
            font-size: 12px;
        }
        
        .no-history {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        
        /* 平板響應式設計 */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .container {
                padding: 30px;
            }
            
            .main-content {
                grid-template-columns: 2fr 1fr;
            }
            
            .dip-switches {
                flex-direction: row;
                gap: 30px;
            }
            
            .switch {
                width: 45px;
                height: 65px;
            }
            
            .binary-display {
                font-size: 24px;
            }
        }
        
        /* 桌面響應式設計 */
        @media (min-width: 1024px) {
            h1 {
                font-size: 2rem;
            }
            
            .input-section label {
                font-size: 18px;
            }
            
            .input-section input {
                font-size: 24px;
                width: 180px;
            }
            
            .input-section button {
                font-size: 18px;
                padding: 12px 24px;
            }
            
            .switch-group h3 {
                font-size: 1.3rem;
            }
        }
        
        /* 小螢幕優化 */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
                margin: 5px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .input-controls {
                flex-direction: column;
            }
            
            .input-section input {
                width: 100%;
                max-width: 200px;
            }
            
            .input-section button {
                width: 100%;
                max-width: 200px;
            }
            
            .switch {
                width: 40px;
                height: 60px;
            }
            
            .switch-position {
                width: 30px;
                height: 20px;
                font-size: 10px;
            }
            
            .binary-display {
                font-size: 18px;
            }
            
            .switches {
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SimPlex探測器二進制自動計算<</h1>
        
        <div class="main-content">
            <div class="calculator-section">
                <div class="input-section">
                    <label for="addressInput">請輸入地址號碼 (0-255)：</label>
                    <div class="input-controls">
                        <input type="number" id="addressInput" min="0" max="255" placeholder="例如: 125">
                        <button onclick="calculateDipSwitches()">計算設定</button>
                        <button class="clear-history" onclick="clearHistory()">清除歷史</button>
                    </div>
                </div>
                
                <div class="error" id="errorMessage"></div>
                
                <div class="result-section" id="resultSection">
                    <h2 style="text-align: center; color: #333;">DIP開關設定結果</h2>
                    
                    <div class="info">
                        <strong>地址號碼：</strong> <span id="addressNumber"></span><br>
                        <strong>8位二進制：</strong> <span id="binaryFull"></span>
                    </div>
                    
                    <div class="dip-switches">
                        <div class="switch-group">
                            <h3>1~4號開關 (LSB)</h3>
                            <div class="switches" id="switches1to4"></div>
                            <div class="binary-display" id="binary1to4"></div>
                        </div>
                        
                        <div class="switch-group">
                            <h3>5~8號開關 (MSB)</h3>
                            <div class="switches" id="switches5to8"></div>
                            <div class="binary-display" id="binary5to8"></div>
                        </div>
                    </div>
                    
                    <div class="info">
                        <strong>設定說明：</strong><br>
                        • 開關向上(ON) = 1<br>
                        • 開關向下(OFF) = 0<br>
                        • 綠色 = ON (1)，紅色 = OFF (0)
                    </div>
                </div>
            </div>
            
            <div class="history-section">
                <h3>📋 計算歷史</h3>
                <div class="history-list" id="historyList">
                    <div class="no-history">尚無計算記錄</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 歷史記錄存儲
        let calculationHistory = [];
        
        // 從localStorage載入歷史記錄
        function loadHistory() {
            const saved = localStorage.getItem('dipSwitchHistory');
            if (saved) {
                calculationHistory = JSON.parse(saved);
                updateHistoryDisplay();
            }
        }
        
        // 保存歷史記錄到localStorage
        function saveHistory() {
            localStorage.setItem('dipSwitchHistory', JSON.stringify(calculationHistory));
        }
        
        function calculateDipSwitches() {
            const input = document.getElementById('addressInput');
            const address = parseInt(input.value);
            const errorDiv = document.getElementById('errorMessage');
            const resultDiv = document.getElementById('resultSection');
            
            // 清除之前的錯誤訊息
            errorDiv.style.display = 'none';
            
            // 驗證輸入
            if (isNaN(address) || address < 0 || address > 255) {
                errorDiv.textContent = '請輸入有效的地址號碼 (0-255)';
                errorDiv.style.display = 'block';
                resultDiv.style.display = 'none';
                return;
            }
            
            // 轉換為8位二進制
            const binary = address.toString(2).padStart(8, '0');
            
            // 分割為兩組 (LSB 1-4, MSB 5-8)
            const lsb = binary.slice(4, 8); // 後4位 (1-4號)
            const msb = binary.slice(0, 4); // 前4位 (5-8號)
            
            // 更新顯示
            document.getElementById('addressNumber').textContent = address;
            document.getElementById('binaryFull').textContent = binary;
            document.getElementById('binary1to4').textContent = lsb;
            document.getElementById('binary5to8').textContent = msb;
            
            // 生成開關視覺化
            generateSwitches('switches1to4', lsb, [1, 2, 3, 4]);
            generateSwitches('switches5to8', msb, [5, 6, 7, 8]);
            
            // 添加到歷史記錄
            addToHistory(address, binary, lsb, msb);
            
            // 顯示結果
            resultDiv.style.display = 'block';
        }
        
        function addToHistory(address, binary, lsb, msb) {
            const timestamp = new Date().toLocaleString('zh-TW');
            
            // 檢查是否已存在相同的地址
            const existingIndex = calculationHistory.findIndex(item => item.address === address);
            
            const historyItem = {
                address: address,
                binary: binary,
                lsb: lsb,
                msb: msb,
                timestamp: timestamp
            };
            
            if (existingIndex !== -1) {
                // 更新現有記錄的時間戳
                calculationHistory[existingIndex] = historyItem;
            } else {
                // 添加新記錄到開頭
                calculationHistory.unshift(historyItem);
            }
            
            // 限制歷史記錄數量為20筆
            if (calculationHistory.length > 20) {
                calculationHistory = calculationHistory.slice(0, 20);
            }
            
            saveHistory();
            updateHistoryDisplay();
        }
        
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            
            if (calculationHistory.length === 0) {
                historyList.innerHTML = '<div class="no-history">尚無計算記錄</div>';
                return;
            }
            
            historyList.innerHTML = '';
            
            calculationHistory.forEach((item, index) => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.onclick = () => loadFromHistory(item);
                
                historyItem.innerHTML = `
                    <div class="history-item-header">地址 ${item.address}</div>
                    <div class="history-item-details">
                        二進制: ${item.binary}<br>
                        1-4號: ${item.lsb} | 5-8號: ${item.msb}<br>
                        時間: ${item.timestamp}
                    </div>
                `;
                
                historyList.appendChild(historyItem);
            });
        }
        
        function loadFromHistory(item) {
            document.getElementById('addressInput').value = item.address;
            calculateDipSwitches();
        }
        
        function clearHistory() {
            if (confirm('確定要清除所有歷史記錄嗎？')) {
                calculationHistory = [];
                localStorage.removeItem('dipSwitchHistory');
                updateHistoryDisplay();
            }
        }
        
        function generateSwitches(containerId, binaryString, switchNumbers) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                const bit = binaryString[i];
                const switchDiv = document.createElement('div');
                switchDiv.className = 'switch';
                
                const numberDiv = document.createElement('div');
                numberDiv.className = 'switch-number';
                numberDiv.textContent = switchNumbers[i];
                
                const positionDiv = document.createElement('div');
                positionDiv.className = 'switch-position';
                
                if (bit === '1') {
                    positionDiv.className += ' switch-on';
                    positionDiv.textContent = 'ON';
                } else {
                    positionDiv.className += ' switch-off';
                    positionDiv.textContent = 'OFF';
                }
                
                switchDiv.appendChild(numberDiv);
                switchDiv.appendChild(positionDiv);
                container.appendChild(switchDiv);
            }
        }
        
        // 允許按Enter鍵計算
        document.getElementById('addressInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateDipSwitches();
            }
        });
        
        // 頁面載入時載入歷史記錄並自動計算125的例子
        window.onload = function() {
            loadHistory();
            document.getElementById('addressInput').value = 125;
            calculateDipSwitches();
        };
    </script>
</body>
</html>


